<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nemo.user.products.repository.impl.UserProductsEditMapper">

	<resultMap id="productEditMap" type="com.nemo.user.products.vo.UserProductsEditVO">
		<association property="productVO" resultMap="com.nemo.user.products.repository.impl.ProductsMapper.productMap"/>
		<association property="productCateVO" resultMap="com.nemo.user.products.repository.impl.UserProductsCategoryMapper.productsCateMap"/>
		<collection property="productImgList" resultMap="com.nemo.user.products.repository.impl.ProductsImageMapper.productImgMap"/>
	</resultMap>
	
	<select id="getProductEditVO" parameterType="int" resultMap="productEditMap">
		SELECT a.*, b.*, c.*
		FROM product_tb a
		INNER JOIN (product_img_tb) b
		ON (a.product_no = b.product_no AND a.product_no = #{productNo})
		INNER JOIN (product_cate_tb) c
		ON (a.product_cate_no = c.product_cate_no)
	</select>
	
	<select id="getProductCateList" parameterType="hashMap" resultMap="com.nemo.user.products.repository.impl.UserProductsCategoryMapper.productsCateMap">
		SELECT a.product_cate_no, a.product_cate_type, a.product_cate_large, a.product_cate_medium, a.product_cate_small
		FROM product_cate_tb a
		WHERE a.product_cate_type = 'L'
		UNION ALL
			SELECT a.product_cate_no, a.product_cate_type, a.product_cate_large, a.product_cate_medium, a.product_cate_small
			FROM product_cate_tb a
			INNER JOIN (SELECT product_cate_no, product_cate_type, product_cate_large, product_cate_medium, product_cate_small FROM product_cate_tb WHERE product_cate_no = #{productCateNo}) b
			ON a.product_cate_no = b.product_cate_no and a.product_cate_large = b.product_cate_large AND a.product_cate_type = 'M'
		<if test='productCateType != "L"'>
		UNION ALL
			SELECT a.product_cate_no, a.product_cate_type, a.product_cate_large, a.product_cate_medium, a.product_cate_small
			FROM product_cate_tb a
			INNER JOIN (SELECT product_cate_no, product_cate_type, product_cate_large, product_cate_medium, product_cate_small FROM product_cate_tb WHERE product_cate_no = #{productCateNo}) b
			ON a.product_cate_no = b.product_cate_no and a.product_cate_large = b.product_cate_large AND a.product_cate_type = 'S'
		</if>
		
	
	</select>
	
</mapper>